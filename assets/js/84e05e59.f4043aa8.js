"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5384],{3905:function(e,n,t){t.d(n,{Zo:function(){return d},kt:function(){return m}});var l=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);n&&(l=l.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,l)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){if(null==e)return{};var t,l,r=function(e,n){if(null==e)return{};var t,l,r={},o=Object.keys(e);for(l=0;l<o.length;l++)t=o[l],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(l=0;l<o.length;l++)t=o[l],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=l.createContext({}),u=function(e){var n=l.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},d=function(e){var n=u(e.components);return l.createElement(s.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return l.createElement(l.Fragment,{},n)}},p=l.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,d=a(e,["components","mdxType","originalType","parentName"]),p=u(t),m=r,h=p["".concat(s,".").concat(m)]||p[m]||c[m]||o;return t?l.createElement(h,i(i({ref:n},d),{},{components:t})):l.createElement(h,i({ref:n},d))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=p;var a={};for(var s in n)hasOwnProperty.call(n,s)&&(a[s]=n[s]);a.originalType=e,a.mdxType="string"==typeof e?e:r,i[1]=a;for(var u=2;u<o;u++)i[u]=t[u];return l.createElement.apply(null,i)}return l.createElement.apply(null,t)}p.displayName="MDXCreateElement"},9817:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return a},contentTitle:function(){return s},metadata:function(){return u},toc:function(){return d},default:function(){return p}});var l=t(7462),r=t(3366),o=(t(7294),t(3905)),i=["components"],a={id:"install-longhorn",title:"Install Longhorn"},s=void 0,u={unversionedId:"Kubernetes-Advanced/install-longhorn",id:"Kubernetes-Advanced/install-longhorn",isDocsHomePage:!1,title:"Install Longhorn",description:"Lien vers la documentation officielle//longhorn.io/docs/1.1.0/deploy/install/",source:"@site/docs/Kubernetes-Advanced/install-longhorn.md",sourceDirName:"Kubernetes-Advanced",slug:"/Kubernetes-Advanced/install-longhorn",permalink:"/docs/Kubernetes-Advanced/install-longhorn",editUrl:"https://github.com/j-peguet/portfolio/blob/master/docs/Kubernetes-Advanced/install-longhorn.md",tags:[],version:"current",lastUpdatedAt:1630868816,formattedLastUpdatedAt:"9/5/2021",frontMatter:{id:"install-longhorn",title:"Install Longhorn"},sidebar:"docs",previous:{title:"Install Traefik",permalink:"/docs/Kubernetes-Advanced/install-traefik"},next:{title:"Install PostgreSQL",permalink:"/docs/PostgreSQL/install-postgresql"}},d=[{value:"Verification du l&#39;infrastrucure",id:"verification-du-linfrastrucure",children:[],level:3},{value:"Installation de Longhorn",id:"installation-de-longhorn",children:[{value:"Pr\xe9requis",id:"pr\xe9requis",children:[{value:"Installer open-iscsi",id:"installer-open-iscsi",children:[],level:4},{value:"Installer NFSv4 client",id:"installer-nfsv4-client",children:[],level:4},{value:"Version de Kubernetes",id:"version-de-kubernetes",children:[],level:4}],level:3},{value:"R\xe9cup\xe9ration de l&#39;outil",id:"r\xe9cup\xe9ration-de-loutil",children:[],level:3}],level:2},{value:"Ajout de disques sp\xe9cifiques",id:"ajout-de-disques-sp\xe9cifiques",children:[{value:"Ajouter le disque dur",id:"ajouter-le-disque-dur",children:[],level:3},{value:"Formatter le disque",id:"formatter-le-disque",children:[],level:3},{value:"Monter le volume",id:"monter-le-volume",children:[],level:3},{value:"Relancer le service Longhorn",id:"relancer-le-service-longhorn",children:[],level:3}],level:2},{value:"Utiliser Longhorn",id:"utiliser-longhorn",children:[],level:2}],c={toc:d};function p(e){var n=e.components,a=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,l.Z)({},c,a,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Lien vers la documentation officielle: ",(0,o.kt)("a",{parentName:"p",href:"https://longhorn.io/docs/1.1.0/deploy/install/"},"https://longhorn.io/docs/1.1.0/deploy/install/")),(0,o.kt)("p",null,"check is longhorn est possible"),(0,o.kt)("h3",{id:"verification-du-linfrastrucure"},"Verification du l'infrastrucure"),(0,o.kt)("p",null,"Un script est disponible pour v\xe9rifier que l'architecture de votre cluster est compatible avec Longhorn."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"curl -sSfL https://raw.githubusercontent.com/longhorn/longhorn/v1.1.0/scripts/environment_check.sh | bash\n")),(0,o.kt)("h2",{id:"installation-de-longhorn"},"Installation de Longhorn"),(0,o.kt)("h3",{id:"pr\xe9requis"},"Pr\xe9requis"),(0,o.kt)("p",null,"Ces \xe9tapes sont \xe0 faire sur toutes les machines constituant le cluster (les Masters et les Nodes)."),(0,o.kt)("h4",{id:"installer-open-iscsi"},"Installer open-iscsi"),(0,o.kt)("p",null,"isntaller sur toutes les vms"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"apt-get install open-iscsi\n")),(0,o.kt)("h4",{id:"installer-nfsv4-client"},"Installer NFSv4 client"),(0,o.kt)("p",null,"Pour les serveurs utilisant Ubuntu ou Debian"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"apt-get install nfs-common\n")),(0,o.kt)("p",null,"Pour RHEL, CentOS et EKS"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"yum install nfs-utils\n")),(0,o.kt)("h4",{id:"version-de-kubernetes"},"Version de Kubernetes"),(0,o.kt)("p",null,"Utilisez cette commande pour v\xe9rifier votre version de Kubernetes."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo kubectl version\n")),(0,o.kt)("p",null,"La ",(0,o.kt)("code",null,"Server Version")," doit \xeatre de ",(0,o.kt)("code",null,"v1.16")," ou sup\xe9rieure."),(0,o.kt)("h3",{id:"r\xe9cup\xe9ration-de-loutil"},"R\xe9cup\xe9ration de l'outil"),(0,o.kt)("p",null,"Nous allons cr\xe9er un dossier contenant les fichiers de configuration de Longhorn. Puis t\xe9l\xe9charger et ex\xe9cuter les fichiers yaml."),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://longhorn.io/docs/1.1.0/deploy/install/install-with-kubectl/"},"https://longhorn.io/docs/1.1.0/deploy/install/install-with-kubectl/")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir longhorn\ncd longhorn\nwget https://raw.githubusercontent.com/longhorn/longhorn/v1.1.0/deploy/longhorn.yaml\n\nsudo kubectl apply -f longhorn.yaml\n")),(0,o.kt)("p",null,"Pour v\xe9rifier que l'installation se d\xe9roule correctement, tous les pods doivent avoir le status ",(0,o.kt)("code",null,"Running"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get pods --namespace longhorn-system --watch\n")),(0,o.kt)("h2",{id:"ajout-de-disques-sp\xe9cifiques"},"Ajout de disques sp\xe9cifiques"),(0,o.kt)("p",null,"Cette \xe9tape est optionnelle, mais ",(0,o.kt)("strong",{parentName:"p"},"fortement recommand\xe9e"),". Elle vise \xe0 ajouter des disques durs sp\xe9cique \xe0 longhorn (\xe0 faire sur chaque Node)."),(0,o.kt)("h3",{id:"ajouter-le-disque-dur"},"Ajouter le disque dur"),(0,o.kt)("p",null,"Ajout un disque dur sur votre Machine de mani\xe8re physique ou logique, dans cet exemple 20Go seront ajout\xe9."),(0,o.kt)("h3",{id:"formatter-le-disque"},"Formatter le disque"),(0,o.kt)("p",null,"Lien compl\xe9mentaire ici: ",(0,o.kt)("a",{parentName:"p",href:"https://www.tecmint.com/add-new-disk-to-an-existing-linux/"},"https://www.tecmint.com/add-new-disk-to-an-existing-linux/")),(0,o.kt)("p",null,"Lister tous les disques de votre systemes et s\xe9lectionner le nouveau disque, g\xe9n\xe9ralement /dev/sdb."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"fdisk -l\nfdisk /dev/sdb\n")),(0,o.kt)("p",null,"Dans le menu fdisk s\xe9lectionner ",(0,o.kt)("code",null,"n")," et ",(0,o.kt)("code",null,"p")," pour cr\xe9er et d\xe9clarer la nouvelle partition comme partition principale."),(0,o.kt)("p",null,"Puis ",(0,o.kt)("code",null,"w")," pour sauvegarder la configuration."),(0,o.kt)("p",null,"Formatage du disque en ext4."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"mfs.ext4  /dev/sdb\n")),(0,o.kt)("h3",{id:"monter-le-volume"},"Monter le volume"),(0,o.kt)("p",null,"Maintenant que le volume est cr\xe9er, nous allons le monter automatiquement \xe0 chaque d\xe9marrage de la machine."),(0,o.kt)("p",null,"Nous cr\xe9ons un dossier ",(0,o.kt)("code",null,"/mnt/longhorn")," qui sera l'emplacement de notre nouveau disque."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo mkdir /mnt/longhorn\nmount /dev/sdb1 /mnt/longhorn\n")),(0,o.kt)("p",null,"Rajouter la ligne dans ",(0,o.kt)("code",null,"/etc/fstab")," pour monter la partition lors du boot."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"/dev/sdb1 /mnt/longhorn ext4 defaults 0 0\n")),(0,o.kt)("h3",{id:"relancer-le-service-longhorn"},"Relancer le service Longhorn"),(0,o.kt)("p",null,"Modifier dans le fichier ",(0,o.kt)("code",null,"longhorn.yaml"),"."),(0,o.kt)("p",null,'Allez dans le ConfigMap "longhorn-default-setting" et modifier les lignes ci-dessous.'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"create-default-disk-labeled-nodes: true\ndefault-data-path: /mnt/longhorn/\n")),(0,o.kt)("p",null,"Puis appliquer les modifications du fichier."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo kubectl apply -f longhorn.yaml\n")),(0,o.kt)("p",null,"Il faut ensuite ajouter les disques \xe0 la configuration de Longhorn. Acc\xe9der au portail via le service longhorn-frontend."),(0,o.kt)("p",null,"Dans le dashboard Longhorn editer la node et ajouter le disk en renseignant:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"nom"),(0,o.kt)("li",{parentName:"ul"},"espace"),(0,o.kt)("li",{parentName:"ul"},"path (/mnt/longhorn)"),(0,o.kt)("li",{parentName:"ul"},"enable le disk")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"longhorn edit node",src:t(6518).Z})),(0,o.kt)("p",null,"Les disques doivent avoir le status Schedulable."),(0,o.kt)("p",null,"F\xe9liciations \ud83c\udf89 !! L'installation de Longhorn est finie (\xe0 vous les joies du stockage distribu\xe9)."),(0,o.kt)("h2",{id:"utiliser-longhorn"},"Utiliser Longhorn"),(0,o.kt)("p",null,"Pour utiliser le service Longhorn, lors de la cr\xe9ation d'un pvc il suffit de sp\xe9cifier le service comme dans l'exemple ci-dessous."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"storageClass: longhorn\n")))}p.isMDXComponent=!0},6518:function(e,n,t){n.Z=t.p+"assets/images/longhorn-edit-node-f3ac38b0e542882bedbf95b8d815d570.png"}}]);