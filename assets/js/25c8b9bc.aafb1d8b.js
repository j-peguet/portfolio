"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2580],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var o=r.createContext({}),u=function(e){var t=r.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(o.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,o=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=u(n),m=a,b=d["".concat(o,".").concat(m)]||d[m]||p[m]||l;return n?r.createElement(b,s(s({ref:t},c),{},{components:n})):r.createElement(b,s({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,s=new Array(l);s[0]=d;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i.mdxType="string"==typeof e?e:a,s[1]=i;for(var u=2;u<l;u++)s[u]=n[u];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},4500:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return o},metadata:function(){return u},toc:function(){return c},default:function(){return d}});var r=n(7462),a=n(3366),l=(n(7294),n(3905)),s=["components"],i={id:"install-kubespray",title:"Install Kubespray"},o=void 0,u={unversionedId:"Kubernetes-Advanced/install-kubespray",id:"Kubernetes-Advanced/install-kubespray",isDocsHomePage:!1,title:"Install Kubespray",description:"Nous allons installer un cluster master-master kubernetes avec kubespray.",source:"@site/docs/Kubernetes-Advanced/install-kubespray.md",sourceDirName:"Kubernetes-Advanced",slug:"/Kubernetes-Advanced/install-kubespray",permalink:"/docs/Kubernetes-Advanced/install-kubespray",editUrl:"https://github.com/j-peguet/portfolio/blob/master/docs/Kubernetes-Advanced/install-kubespray.md",tags:[],version:"current",lastUpdatedAt:1618828164,formattedLastUpdatedAt:"4/19/2021",frontMatter:{id:"install-kubespray",title:"Install Kubespray"},sidebar:"docs",previous:{title:"Install Calico Beta",permalink:"/docs/Kubernetes-Advanced/install-calico-beta"},next:{title:"Install MetalLB",permalink:"/docs/Kubernetes-Advanced/install-metallb"}},c=[{value:"Installation de Kubespray",id:"installation-de-kubespray",children:[{value:"R\xe9cup\xe9ration de l&#39;outil",id:"r\xe9cup\xe9ration-de-loutil",children:[],level:3},{value:"Environnement de travail",id:"environnement-de-travail",children:[],level:3}],level:2},{value:"Cr\xe9ation du cluster",id:"cr\xe9ation-du-cluster",children:[{value:"Configuration",id:"configuration",children:[],level:3},{value:"Installation",id:"installation",children:[],level:3}],level:2}],p={toc:c};function d(e){var t=e.components,n=(0,a.Z)(e,s);return(0,l.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"Nous allons installer un cluster master-master kubernetes avec kubespray.\nLa configuration permettra \xe9galement d'ajouter toutes les nodes voulues au cluster."),(0,l.kt)("p",null,"Dans notre exemple, notre r\xe9seau comportera:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"3 masters"),(0,l.kt)("li",{parentName:"ul"},"3 nodes")),(0,l.kt)("p",null,"Chaque machine doit \xeatre initialis\xe9 avec la configuration disponible ",(0,l.kt)("a",{parentName:"p",href:"/docs/Kubernetes-Advanced/setup-vm"},"ici"),"."),(0,l.kt)("h2",{id:"installation-de-kubespray"},"Installation de Kubespray"),(0,l.kt)("p",null,"Ces \xe9tapes sont \xe0 faire sur la machine Master uniquement."),(0,l.kt)("h3",{id:"r\xe9cup\xe9ration-de-loutil"},"R\xe9cup\xe9ration de l'outil"),(0,l.kt)("p",null,"T\xe9l\xe9chager la derni\xe8re version de Kubespray directement depuis le repo officiel."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/kubernetes-sigs/kubespray.git\nsudo apt install -y python3-pip\ncd kubespray\npip3 install -r requirements.txt\n")),(0,l.kt)("h3",{id:"environnement-de-travail"},"Environnement de travail"),(0,l.kt)("p",null,"Copier l'int\xe9gralit\xe9 des fichiers de configuration par d\xe9faut dans un nouveau dossier ",(0,l.kt)("code",null,"mycluster"),". Ce dossier comportera toutes les modifications sp\xe9cifiques de notre cluster."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"cp -rfp inventory/sample inventory/mycluster\n")),(0,l.kt)("p",null,"Ne pas oublier d'ajouter le dossier ",(0,l.kt)("inlineCode",{parentName:"p"},"/home/<user>/.local/bin")," dans le PATH pour pouvoir lancer la commande ",(0,l.kt)("code",null,"ansible-playbook"),"."),(0,l.kt)("h2",{id:"cr\xe9ation-du-cluster"},"Cr\xe9ation du cluster"),(0,l.kt)("p",null,"Ces \xe9tapes sont \xe0 faire sur la machine Master uniquement."),(0,l.kt)("h3",{id:"configuration"},"Configuration"),(0,l.kt)("p",null,"D\xe9claration des IPs constituant le futur cluster."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"declare -a IPS=(192.168.4.201 192.168.4.202 192.168.4.203 192.168.4.204 192.168.4.205 192.168.4.206)\n")),(0,l.kt)("p",null,"Cr\xe9ation du fichier hosts.ini"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"sudo nano inventory/mycluster/hosts.ini\n")),(0,l.kt)("p",null,"Dans ce fichier, d\xe9clarer les machines constituant le cluster et attribuer leurs roles."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"[all]\nmaster1 ansible_host=192.168.4.201 etcd_member_name=etcd1\nmaster2 ansible_host=192.168.4.202 etcd_member_name=etcd2\nmaster3 ansible_host=192.168.4.203 etcd_member_name=etcd3\n\nnode1 ansible_host=192.168.4.204\nnode2 ansible_host=192.168.4.205\nnode3 ansible_host=192.168.4.206\n\n[kube_control_plane]\nmaster1\nmaster2\nmaster3\n\n[etcd]\nmaster1\nmaster2\nmaster3\n\n[kube-node]\nnode1\nnode2\nnode3\n\n[k8s-cluster:children]\nkube_control_plane\nkube-node\n")),(0,l.kt)("p",null,"Cr\xe9ation d'une public private key le master 1"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"ssh-keygen\n")),(0,l.kt)("p",null,"Copier la cl\xe9 ssh sur les autres serveurs (ne pas oublier de la faire avec l'ip du serbeur master lui m\xeame)"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"ssh-copy-id -i ~/.ssh/id_rsa.pub jules@192.168.4.201\n")),(0,l.kt)("h3",{id:"installation"},"Installation"),(0,l.kt)("p",null,"Cr\xe9ation du cluster"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'ansible-playbook -i inventory/mycluster/hosts.ini --become --become-user=root cluster.yml -v --private-key=~/.ssh/id_rsa --extra-vars="ansible_become_pass=<yourStr0ngP@assword>"\n')),(0,l.kt)("p",null,"Si lors du processus une erreur apparait, il faut r\xe9initialiser le cluster avant de le reconfigurer"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'ansible-playbook -i inventory/mycluster/hosts.ini --become --become-user=root reset.yml -v --private-key=~/.ssh/id_rsa --extra-vars="ansible_become_pass=<yourStr0ngP@assword>"\n')),(0,l.kt)("p",null,"F\xe9liciations \ud83c\udf89 !! Votre cluster avec Kubespray est termin\xe9."))}d.isMDXComponent=!0}}]);