"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3464],{3905:function(e,t,l){l.d(t,{Zo:function(){return p},kt:function(){return m}});var n=l(7294);function a(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}function r(e,t){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),l.push.apply(l,n)}return l}function o(e){for(var t=1;t<arguments.length;t++){var l=null!=arguments[t]?arguments[t]:{};t%2?r(Object(l),!0).forEach((function(t){a(e,t,l[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):r(Object(l)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(l,t))}))}return e}function s(e,t){if(null==e)return{};var l,n,a=function(e,t){if(null==e)return{};var l,n,a={},r=Object.keys(e);for(n=0;n<r.length;n++)l=r[n],t.indexOf(l)>=0||(a[l]=e[l]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)l=r[n],t.indexOf(l)>=0||Object.prototype.propertyIsEnumerable.call(e,l)&&(a[l]=e[l])}return a}var i=n.createContext({}),c=function(e){var t=n.useContext(i),l=t;return e&&(l="function"==typeof e?e(t):o(o({},t),e)),l},p=function(e){var t=c(e.components);return n.createElement(i.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var l=e.components,a=e.mdxType,r=e.originalType,i=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(l),m=a,g=u["".concat(i,".").concat(m)]||u[m]||d[m]||r;return l?n.createElement(g,o(o({ref:t},p),{},{components:l})):n.createElement(g,o({ref:t},p))}));function m(e,t){var l=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=l.length,o=new Array(r);o[0]=u;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var c=2;c<r;c++)o[c]=l[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,l)}u.displayName="MDXCreateElement"},8525:function(e,t,l){l.r(t),l.d(t,{frontMatter:function(){return s},contentTitle:function(){return i},metadata:function(){return c},toc:function(){return p},default:function(){return u}});var n=l(3117),a=l(102),r=(l(7294),l(3905)),o=["components"],s={id:"5_application_deployement",title:"Application deployment"},i=void 0,c={unversionedId:"Kubernetes/install_&_configuration/5_application_deployement",id:"Kubernetes/install_&_configuration/5_application_deployement",title:"Application deployment",description:"Imperative configuration",source:"@site/docs/Kubernetes/1_install_&_configuration/5_application_deployment.md",sourceDirName:"Kubernetes/1_install_&_configuration",slug:"/Kubernetes/install_&_configuration/5_application_deployement",permalink:"/docs/Kubernetes/install_&_configuration/5_application_deployement",editUrl:"https://github.com/j-peguet/portfolio/blob/master/docs/Kubernetes/1_install_&_configuration/5_application_deployment.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{id:"5_application_deployement",title:"Application deployment"},sidebar:"docs",previous:{title:"Use Kubectl",permalink:"/docs/Kubernetes/install_&_configuration/4_use_Kubectl"},next:{title:"Manifest",permalink:"/docs/Kubernetes/install_&_configuration/6_manifest"}},p=[{value:"Imperative configuration",id:"imperative-configuration",children:[{value:"Example C\xf4t\xe9 Master",id:"example-c\xf4t\xe9-master",children:[],level:3},{value:"Example C\xf4t\xe9 Node",id:"example-c\xf4t\xe9-node",children:[],level:3},{value:"Regarder les logs",id:"regarder-les-logs",children:[],level:3},{value:"Exec in a container",id:"exec-in-a-container",children:[],level:3},{value:"D\xe9tail du d\xe9ploiement",id:"d\xe9tail-du-d\xe9ploiement",children:[],level:3}],level:2},{value:"Declarative configuration",id:"declarative-configuration",children:[{value:"Nous d\xe9finissons l&#39;\xe9tat d\xe9sir\xe9 dans le code",id:"nous-d\xe9finissons-l\xe9tat-d\xe9sir\xe9-dans-le-code",children:[],level:3}],level:2}],d={toc:p};function u(e){var t=e.components,s=(0,a.Z)(e,o);return(0,r.kt)("wrapper",(0,n.Z)({},d,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"imperative-configuration"},"Imperative configuration"),(0,r.kt)("p",null,"La configuration imperative, s'execute une ligne de commande apr\xe8s l'autre.\nCr\xe9ant ainsi un objet apr\xe8s l'autre."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl create deployment nginx --image=nginx\n")),(0,r.kt)("p",null,'La commande passe par "l\'API Server", un objet est cr\xe9e. Mais en ligne de commande seul un ibjet \xe0 la fois peut \xeatre utilis\xe9.'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl run nginx --image=nginx\n")),(0,r.kt)("p",null,"Cela cr\xe9er un pod en utilisant nginx."),(0,r.kt)("p",null,"Cela permet de g\xe9rer le cluster, mais devient difficile si l'architecture ou l'applications se complexifie."),(0,r.kt)("h3",{id:"example-c\xf4t\xe9-master"},"Example C\xf4t\xe9 Master"),(0,r.kt)("p",null,'Creation d\'un d\xe9ploiement nomm\xe9 "hello-world", le conteneur est simplement un serveur web affichant "Hello World"'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl create deployment hello-world --image=gcr.io/google-samples/hello-app:1.0\n")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"create deployment",src:l(8003).Z})),(0,r.kt)("p",null,"Il est temps de d\xe9ployer un pod"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl run hello-world-pod --image=gcr.io/google-samples/hello-app:1.0\n")),(0,r.kt)("p",null,"Et de regarder le r\xe9sultat"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get pod\n")),(0,r.kt)("p",null,"Ici nous avons bien nos 2 pods d\xe9ploy\xe9\n",(0,r.kt)("img",{alt:"get deployment pod",src:l(278).Z})),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get deployment\nkubectl get pods -o wide\n")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"get deployment pod",src:l(7226).Z})),(0,r.kt)("h3",{id:"example-c\xf4t\xe9-node"},"Example C\xf4t\xe9 Node"),(0,r.kt)("p",null,"Il est int\xe9ressant de voir comment les conteneurs ont \xe9t\xe9 g\xe9n\xe9r\xe9 dans les nodes"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"bash\nssh jules@c1-node1\nsudo docker ps\n")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"docker node",src:l(6687).Z})),(0,r.kt)("h3",{id:"regarder-les-logs"},"Regarder les logs"),(0,r.kt)("p",null,"Il est int\xe9ressant de regarder les logs provenant de cette manipulation"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl log hello-world-pod\n")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"log hello world",src:l(9912).Z})),(0,r.kt)("h3",{id:"exec-in-a-container"},"Exec in a container"),(0,r.kt)("p",null,"Il est possible comme avec Docker de se connecter \xe0 un conteneur"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl exec -it hello-world-pod -- /bin/sh\n")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"log hello world",src:l(7332).Z})),(0,r.kt)("h3",{id:"d\xe9tail-du-d\xe9ploiement"},"D\xe9tail du d\xe9ploiement"),(0,r.kt)("p",null,"Ces commandes permettent de regarder l'\xe9tat actuel du d\xe9ploiement"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get deployments.apps hello-world\nkubectl get replicasets.apps\nkubectl get pods\n")),(0,r.kt)("p",null,'Tous est UP et dans le "desired state"'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# Take a closer look at our application using: describe\nkubectl describe deployments.apps hello-world\nkubectl describe pods hello-world-5457b44555-qjcrx\n#But the service is not expose, let's do it\nkubectl expose deployment hello-world --port=80 --target-port=8080\n")),(0,r.kt)("p",null,"Maintenant que le service est expos\xe9, il est possible de regarder le r\xe9sultat"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get service hello-world\n")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"get service",src:l(7525).Z})),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"#More precise information about the service\nkubectl describe service hello-world\n#Test the container\ncurl http://10.104.116.230:80\n")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"get service",src:l(1450).Z})),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"#List all the endpoint of a service\nkubectl get endpoints hello-world\n")),(0,r.kt)("p",null,'En faisant la requ\xeate curl sur l\'IP et le port de la commande "get endpoints", nous outrepassons le service de load balancer en acc\xe9dant au pod directement. Pratique pour le d\xe9bug, mais pas pour la prod.'),(0,r.kt)("h2",{id:"declarative-configuration"},"Declarative configuration"),(0,r.kt)("h3",{id:"nous-d\xe9finissons-l\xe9tat-d\xe9sir\xe9-dans-le-code"},"Nous d\xe9finissons l'\xe9tat d\xe9sir\xe9 dans le code"),(0,r.kt)("p",null,"A travers des manifest, nous pouvons d'\xe9crire l'\xe9tat dans lequel nous voulons que l'architecture soit maintenue."),(0,r.kt)("p",null,'Ces manifest peuvent \xeatre \xe9crit en JSON ou YAML et \xeatre donn\xe9 \xe0 "l\'API Server" via'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f deployment.yaml\n")),(0,r.kt)("p",null,"Nous r\xe9cup\xe9rons la configuration de notre service pr\xe9c\xe9demment install\xe9."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"#Using kubectl to generate yaml or json files of our imperitive configuration.\nkubectl get service hello-world -o yaml\nkubectl get service hello-world -o json\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},'WARNING: "--export is deprecated" nous verrons plus loin comment g\xe9n\xe9rer de nouveaux ces fichiers')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"#Save theses info for a redeployment\nkubectl get service hello-world -o yaml --export > service-hello-world.yaml\nkubectl get deployment hello-world -o yaml --export > deployment-hello-world.yaml\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"#We can ask the API for more information about an object\nkubectl explain service | more\n\n#And drill down further if needed, includes very good explanation of what's available for that resource\nkubectl explain service.spec | more\nkubectl explain service.spec.ports\nkubectl explain service.spec.ports.targetPort\n")),(0,r.kt)("p",null,"Supprimons les instances cr\xe9er pr\xe9c\xe9demment"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl delete service hello-world\nkubectl delete deployment hello-world\nkubectl delete pod hello-world-pod\nkubectl get all\n")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"delete",src:l(3172).Z})),(0,r.kt)("p",null,"Cr\xe9ation du d\xe9ploiement"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"#Deploying applications declarativly and store in the file (this command DON'T lauch the deployment)\nkubectl create deployment hello-world \\\n     --image=gcr.io/google-samples/hello-app:1.0 \\\n     --dry-run=client -o yaml > deployment-hello-world.yaml\n\ncat deployment-hello-world.yaml\n#Apply deployment from the file created above\nkubectl apply -f deployment-hello-world.yaml\n")),(0,r.kt)("p",null,"Idem pour le service"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"#Expose the service from the deployment\nkubectl expose deployment hello-world \\\n     --port=80 --target-port=8080 \\\n     --dry-run=client -o yaml > service-hello-world.yaml \n\ncat service-hello-world.yaml \n#If the file already exists\nkubectl apply -f service-hello-world.yaml \n")),(0,r.kt)("p",null,"Grace \xe0 ce syst\xe8me de fichier, il est possible de changer directement la configuration d'un d\xe9ploiement"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"#scale up our deployment\nnano deployment-hello-world.yaml\nChange replicas from 1 to 2\n     replicas: 2\n#Apply the changes\nkubectl apply -f deployment-hello-world.yaml\n#Check it\nkubectl get deployment hello-world\n")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"scale app",src:l(7582).Z})),(0,r.kt)("p",null,"Il est alors possible de tester le load balancer en r\xe9p\xe9tant la requ\xeate curl"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"#Repeat the curl access to see the load balancing of the HTTP request\nkubectl get service hello-world\ncurl http://$SERVICEIP:80\n")),(0,r.kt)("p",null,'Il est \xe9galement possible modifier "on the fly" la configuration'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl edit deployment hello-world\n\n#The deployment is scaled to 3 and we have three pods\nkubectl get deployment hello-world\nkubectl get pods \n\n#Let's clean up our deployment and remove everything\nkubectl delete deployment hello-world\nkubectl delete service hello-world\n\nkubectl get all\n")))}u.isMDXComponent=!0},8003:function(e,t,l){t.Z=l.p+"assets/images/create_deployment-999b0eadcabfb74117ed3b63d5a022cd.png"},1450:function(e,t,l){t.Z=l.p+"assets/images/curl_service-4c7482d8ecada988a672e5f940f4e670.png"},3172:function(e,t,l){t.Z=l.p+"assets/images/delete_all-1dd4f7893797089a883f985e619614af.png"},6687:function(e,t,l){t.Z=l.p+"assets/images/docker_node-3000ed240e2e66b9af8824e290ec843f.png"},7332:function(e,t,l){t.Z=l.p+"assets/images/exec-81804929c3d83ebc8a7a06dbbaba0504.png"},278:function(e,t,l){t.Z=l.p+"assets/images/get_deploy_pods-3e8380857fabc215fefd7415daaf53ef.png"},7226:function(e,t,l){t.Z=l.p+"assets/images/get_deployement-3fde1b051405d8e6eba7cd762f477bde.png"},7525:function(e,t,l){t.Z=l.p+"assets/images/get_service-630a3f7fd435087a1ae2e02eff89a1e0.png"},9912:function(e,t,l){t.Z=l.p+"assets/images/log_hello_world-54b9eb4d9fc70691a18b72395c8aadc9.png"},7582:function(e,t,l){t.Z=l.p+"assets/images/scale_app-97e4f62b684c84e080946e7dbb2dbe7a.png"}}]);